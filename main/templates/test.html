<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>

    <style>
      canvas { border: 1px solid black; }
    </style>

</head>
<body>
  
  <div>
    <input type="text" id="label" >
    <button type="button" class="btn btn-success" onclick="func1();">label</button>
    <button type="button" class="btn btn-success" onclick="clear33();">지우기</button>
    <button onclick="export2json();">다운로드</button>
	  <button onclick="PrintPoints();">불러오기</button>
  </div>
  <form method="post" enctype="multipart/form-data">
    <div class="button">
        <label for="chooseFile">
            
        </label>
    </div>
    <input type="file" id="chooseFile" name="chooseFile" accept="json/*" onchange="loadFile(this)">
  </form>
    <script>
      
    // json 가져오기
    function loadFile(input) {
      var file = input.files[0];	//선택된 파일 가져오기
  
      //미리 만들어 놓은 div에 text(파일 이름) 추가
      var name = document.getElementById('fileName');
  
        //새로운 이미지 div 추가
      var newjson = document.createElement("json");
      newjson.setAttribute("class", 'json');
  
      //이미지 source 가져오기
      newjson.src = URL.createObjectURL(file);  
      console.log(newjson.src); 
  
      newjson.style.width = "70%";
      newjson.style.height = "70%";
      newjson.style.visibility = "hidden";   //버튼을 누르기 전까지는 이미지를 숨긴다
      newjson.style.objectFit = "contain";
  
      //이미지를 image-show div에 추가
      // JSON - JAVASCRIPT OBJECT NOTATION
  //fetch("/media/data (3).json")
  fetch(newjson.src)
  .then(response => response.json())
  .then(data =>{
      console.log(data)
  })
  };
    </script>
  

  <canvas id="my_canvas"></canvas>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script type="text/javascript">
      var my_canvas = document.getElementById('my_canvas');
      my_canvas.width = 800;
      my_canvas.height = 800;
      var ctx = my_canvas.getContext('2d');

      var img = new Image();
      img.onload = function(){
        ctx.drawImage(img, 0, 0, my_canvas.width, my_canvas.height);
        ctx.save();
      }
      // 이미지 URL
      img.src = 'https://img.etoday.co.kr/pto_db/2022/03/600/20220307095246_1725389_1200_899.jpg';
      var obj = new Object();
      obj.points=[];


      ctx.beginPath();
      var t=0;
      var firstX, firstY;

      my_canvas.onmousedown = function(event) {
        
        if(t<0){
        }
        else if(t==0){
          obj.points.push([event.x,event.y]);
          console.log(obj);
          firstX=event.x;
          firstY=event.y;
          ctx.moveTo(event.x, event.y);
          path=ctx.arc(event.x, event.y, 8, 0, Math.PI*2, true);
          ctx.closePath();
          ctx.fill();
        }
        else if(event.x>=firstX-10 && event.x<=firstX+10 && event.y>=firstY*-10 && event.y<=firstY*+10)
        {
          obj.points.push([event.x,event.y]);
          console.log(obj);
          ctx.lineTo(firstX, firstY);
          ctx.fillStyle="red"
          ctx.stroke();
          ctx.fill();
          t=-100;
          
        }
        else{
          obj.points.push([event.x,event.y]);
          console.log(obj);
          ctx.lineTo(event.x, event.y);
          ctx.stroke();
          ctx.moveTo(event.x, event.y);
          ctx.arc(event.x, event.y, 5, 0, Math.PI*2, true);// 원그리기
          ctx.closePath();
          ctx.fill();
        }
      t++
      }

      function func1() {
        obj.label = document.getElementById("label").value;
        console.log(obj);
      }

      function clear33() {
        // obj.points=[];
        console.log('1');
        my_canvas = document.getElementById('my_canvas');
        my_canvas.width = 800;
        my_canvas.height = 800;
        ctx = my_canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, my_canvas.width, my_canvas.height);
        t=0;
      }
      function export2json() {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([JSON.stringify(obj, null, 2)], {
          type: "text/plain"
        }));
        a.setAttribute("download", "data.json");
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

	  function PrintPoints() {
		t=0;
        for(var i of obj.points){
		if(t<0){

		}
        else if(t==0){
          firstX=i[0];
          firstY=i[1];
          ctx.moveTo(i[0], i[1]);
          path=ctx.arc(i[0], i[1], 8, 0, Math.PI*2, true);
          ctx.closePath();
          ctx.fill();
        }
        else if(i[0]>=firstX-10 && i[0]<=firstX+10 && i[1]>=firstY*-10 && i[1]<=firstY*+10)
        {
          ctx.lineTo(firstX, firstY);
          ctx.fillStyle="red"
          ctx.stroke();
          ctx.fill();
          t=-100; 
        }
        else{
          ctx.lineTo(i[0], i[1]);
          ctx.stroke();
          ctx.moveTo(i[0], i[1]);
          ctx.arc(i[0], i[1], 5, 0, Math.PI*2, true);// 원그리기
          ctx.closePath();
          ctx.fill();
        }
      t++
      }
    		
  	}// 함수끝


  </script>

</body>
</html>
